<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Maeoka - Mini App TON (DEMO)</title>
  <!-- Telegram Mini Apps SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <!-- TON Connect UI (CDN) -->
  <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif; margin: 20px; }
    h1 { font-size: 20px; margin: 0 0 12px; }
    .card { border: 1px solid #e5e7eb; border-radius: 12px; padding: 16px; margin: 12px 0; }
    .row { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
    .btn { padding: 10px 14px; border: 1px solid #111827; border-radius: 10px; background: #111827; color: #fff; cursor: pointer; }
    .btn:disabled { opacity: .6; cursor: not-allowed; }
    code, pre { background: #f3f4f6; padding: 8px; border-radius: 8px; display: block; overflow: auto; }
    #result { white-space: pre-wrap; }
    .muted { color: #6b7280; }
  </style>
</head>
<body>
  <h1>Maeoka - Mini App TON (DEMO)</h1>
  <p class="muted">Este é um protótipo sem intenção real de investimento. Conecta uma carteira via TON Connect e simula um “mint” off-chain.</p>

  <div class="card">
    <h3>1) Conectar carteira (TON Connect)</h3>
    <div id="ton-connect"></div>
    <div id="status" class="muted">Status: desconectado</div>
  </div>

  <div class="card">
    <h3>2) Simular “Mint” (apenas visual)</h3>
    <div class="row">
      <label>Projeto: <input id="project" value="Residencial DEMO" /></label>
      <label>% de participação: <input id="percent" type="number" step="0.01" value="0.50" /></label>
      <label>Valor investido (R$): <input id="amount" type="number" step="100" value="1000" /></label>
      <button class="btn" id="simulateBtn" disabled>Gerar NFT (mock)</button>
    </div>
    <small class="muted">Obs.: Isto não grava nada na blockchain. É apenas um preview de como o JSON de um NFT poderia ser.</small>
    <pre id="result"></pre>
  </div>

  <script>
    // 0) Ajusta tema conforme Telegram
    Telegram.WebApp.ready();
    Telegram.WebApp.expand();

    // 1) TON Connect UI
    const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
      manifestUrl: window.location.origin + '/tonconnect-manifest.json',
      buttonRootId: 'ton-connect'
    });
    tonConnectUI.uiOptions = {
      actionsConfiguration: { twaReturnUrl: 'https://t.me/SEU_BOT_AQUI?startapp=1' }
    };

    const statusEl = document.getElementById('status');
    const simulateBtn = document.getElementById('simulateBtn');
    const resultEl = document.getElementById('result');

    function shortAddr(addr) {
      return addr.slice(0, 6) + '…' + addr.slice(-4);
    }

    async function updateStatus() {
      const conn = await tonConnectUI.getWallets();
      const acc = tonConnectUI.account;
      if (acc) {
        statusEl.textContent = 'Status: conectado (' + shortAddr(acc.address) + ')';
        simulateBtn.disabled = false;
      } else {
        statusEl.textContent = 'Status: desconectado';
        simulateBtn.disabled = true;
      }
    }

    tonConnectUI.onStatusChange(updateStatus);
    updateStatus();

    // 2) Simulador de “mint” (gera JSON local)
    document.getElementById('simulateBtn').addEventListener('click', () => {
      const acc = tonConnectUI.account;
      if (!acc) { alert('Conecte uma carteira primeiro.'); return; }
      const project = document.getElementById('project').value || 'Residencial DEMO';
      const percentage = parseFloat(document.getElementById('percent').value || '0');
      const amount = parseFloat(document.getElementById('amount').value || '0');

      const id = 'NFT-' + Math.random().toString(36).slice(2, 8).toUpperCase();
      const now = new Date().toISOString();

      const mockNFT = {
        id,
        owner: acc.address,
        project,
        ownership_percentage: percentage,
        initial_investment_brl: amount,
        created_at: now,
        note: 'PREVIEW LOCAL (não-on-chain)'
      };

      resultEl.textContent = JSON.stringify(mockNFT, null, 2);
    });
  </script>
</body>
</html>
